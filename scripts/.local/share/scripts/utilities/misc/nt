#!/bin/bash
NOTES="${NOTES:-$HOME/notes}"
name="$(date +%d%m%Y).md"
if [[ $1 != "list" ]]; then
    subject="$1"
fi

if [[ -z "$subject" ]]; then
    subject=$(echo -e "$(find "$NOTES" -mindepth 1 -type d)\nnew" | fzf --delimiter / --with-nth -1 --preview="[ -d {} ] && ls {} --color=always || chafa $FILES/fun/kaguya.jpg --stretch")
fi

if [[ $subject == "dmenu" ]]; then
    subject=$(echo -e "$(find "$NOTES" -mindepth 1 -type d -printf '%f\n')\nnew" | dmenu 2>/dev/null )
    if [[ $subject == "new" ]]; then
        st -e nvim "$NOTES" 
        exit
    fi
fi

if [[ $1 == "list" ]]; then
    [[ -z "$subject" ]] && exit
    chosen_file=$(find "$subject" -mindepth 1 -type f -printf '%f\n' | fzf --preview="bat $subject/{} --color=always")
    if [[ -n "$chosen_file" ]]; then
        nvim "$subject/$chosen_file"
    fi
    exit
fi

if [[ $subject == "new" ]]; then
    echo -e "\e[35mEnter new subject"
    read -r subject
fi

[[ -z "$subject" ]] && exit

if [[ ! -d "$NOTES/$subject" ]]; then
    mkdir -p "$NOTES/$subject"
fi

# echo $NOTES/$subject/$name
nvim $NOTES/$subject/$name


